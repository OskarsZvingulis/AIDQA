<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>AIDQA – AI Design QA</title>
    <style>
      body {
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
        margin: 0;
        padding: 12px;
        font-size: 12px;
      }
      h1 {
        font-size: 14px;
        margin: 0 0 8px;
      }
      button {
        padding: 6px 10px;
        border-radius: 6px;
        border: none;
        cursor: pointer;
      }
      #status {
        margin-top: 8px;
      }
      #summary {
        margin-top: 12px;
        padding: 8px;
        border-radius: 6px;
        border: 1px solid #ddd;
      }
      #issues {
        margin-top: 8px;
        max-height: 340px;
        overflow-y: auto;
        border-top: 1px solid #eee;
      }
      .issue {
        padding: 6px 0;
        border-bottom: 1px solid #f0f0f0;
      }
      .issue-type {
        text-transform: uppercase;
        font-size: 10px;
        opacity: 0.7;
      }
      .issue-node {
        font-weight: 600;
      }
    </style>
  </head>
  <body>
    <h1>AIDQA – AI Design QA</h1>
    <button id="scan">Scan selection</button>
    <div id="status"></div>

    <div id="summary"></div>
    <div id="issues"></div>

    <script>
      const scanBtn = document.getElementById("scan");
      const statusEl = document.getElementById("status");
      const summaryEl = document.getElementById("summary");
      const issuesEl = document.getElementById("issues");

      scanBtn.onclick = () => {
        parent.postMessage(
          { pluginMessage: { type: "scan-selection" } },
          "*"
        );
        statusEl.textContent = "Scanning current selection…";
        summaryEl.textContent = "";
        issuesEl.innerHTML = "";
      };

      onmessage = (event) => {
        const msg = event.data.pluginMessage;
        if (!msg) return;

        if (msg.type === "scan-result") {
          if (msg.error) {
            statusEl.textContent = msg.error;
            summaryEl.textContent = "";
            issuesEl.innerHTML = "";
            return;
          }

          const result = msg.payload;
          if (!result) {
            statusEl.textContent = "No result returned.";
            return;
          }

          statusEl.textContent = "Scan complete.";

          const total = result.totalIssues || 0;
          const byType = result.byType || {};
          summaryEl.innerHTML = `
            <div><strong>Total issues:</strong> ${total}</div>
            <div>By type:
              spacing ${byType.spacing ?? 0} ·
              color ${byType.color ?? 0} ·
              text ${byType.text ?? 0} ·
              component ${byType.component ?? 0} ·
              accessibility ${byType.accessibility ?? 0}
            </div>
          `;

          issuesEl.innerHTML = "";
          (result.issues || []).forEach((issue) => {
            const div = document.createElement("div");
            div.className = "issue";
            div.innerHTML = `
              <div class="issue-type">${issue.type}</div>
              <div class="issue-node">${issue.nodeName}</div>
              <div>${issue.description}</div>
              <div><em>${issue.suggestion}</em></div>
            `;
            issuesEl.appendChild(div);
          });
        }
      };
    </script>
  </body>
</html>
